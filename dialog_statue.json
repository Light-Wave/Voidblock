[
  {
    "type": "talk_topic",
    "id": "SKYISLAND_UPGRADE",
    "dynamic_line": "Here you may spend your treasures on upgrades.",
    "responses": [
      {
        "text": "Unlock: RANK UP 1",
        "condition": { "and": [ { "not": { "u_has_mission": "SKYISLAND_UPGRADE_rankup1" } }, { "math": [ "islandrank == 1" ] } ] },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_rankup1" } ],
        "topic": "SKYISLAND_UPGRADE"
      },
      {
        "text": "Unlock: RANK UP 2",
        "condition": { "and": [ { "not": { "u_has_mission": "SKYISLAND_UPGRADE_rankup2" } }, { "math": [ "islandrank == 3" ] } ] },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_rankup2" } ],
        "topic": "SKYISLAND_UPGRADE"
      },
      { "text": "Empower the warp obelisk.", "topic": "SKYISLAND_UPGRADES_RAIDS" },
      { "text": "Make the island more hospitable.", "topic": "SKYISLAND_UPGRADES_TERRAFORM" },
      { "text": "Upgrade expeditions.", "topic": "SKYISLAND_UPGRADES_FEATURES" },
      { "text": "Construction options.", "topic": "SKYISLAND_UPGRADES_INFRASTRUCTURE",
        "condition": { "not": { "mod_is_loaded": "voidblock" } } },
      { "text": "I need your services.", "topic": "SKYISLAND_SERVICES" },
      { "text": "I have some questions.", "topic": "SKYISLAND_QUESTIONS" },
      { "text": "Another time.  Goodbye.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "SKYISLAND_SERVICES",
    "dynamic_line": "How may I help?",
    "responses": [
      {
        "text": "Heal me.  (Free)",
        "condition": { "math": [ "islandrank == 0" ] },
        "effect": [ { "run_eocs": [ "EOC_HEAL_NEWBIE" ] } ],
        "topic": "SKYISLAND_SERVICES"
      },
      {
        "text": "Heal me.  (Costs 4 Warp Shards)",
        "condition": { "math": [ "islandrank > 0" ] },
        "effect": [ { "run_eocs": [ "EOC_HEAL_NEWBIE" ] } ],
        "topic": "SKYISLAND_SERVICES"
      },
      {
        "text": "End an active portal storm.",
        "effect": [
          { "run_eocs": [ "EOC_CANCEL_PORTAL_STORM" ] },
          { "u_message": "The air crackles with static electricity, then stabilizes.", "popup": true }
        ],
        "topic": "SKYISLAND_SERVICES"
      },
      {
        "text": "View my expedition stats.",
        "effect": [ { "run_eocs": [ "EOC_statcheck" ] } ],
        "topic": "SKYISLAND_SERVICES"
      },
      {
        "text": "View my upgrade stats.",
        "effect": [ { "run_eocs": [ "EOC_progresscheck" ] } ],
        "topic": "SKYISLAND_SERVICES"
      },
      {
        "text": "View my construction stats.",
        "effect": [ { "run_eocs": [ "EOC_buildcheck" ] } ],
        "topic": "SKYISLAND_SERVICES",
        "condition": { "not": { "mod_is_loaded": "voidblock" } }
      },
      {
        "text": "Change my difficulty settings.",
        "effect": [ { "run_eocs": [ "EOC_difficultycheck" ] } ],
        "topic": "SKYISLAND_SERVICES"
      },
      { "text": "Let's return to discussing upgrades.", "topic": "SKYISLAND_UPGRADE" },
      { "text": "That's all.  Goodbye.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "SKYISLAND_UPGRADES_RAIDS",
    "dynamic_line": "By empowering the warp obelisk, you can expand the quality and variety of available expeditions.",
    "responses": [
      {
        "text": "Unlock: Large Expeditions",
        "condition": {
          "and": [
            { "not": { "u_has_mission": "SKYISLAND_UPGRADE_raidlength1" } },
            { "math": [ "longerraids == 0" ] },
            { "math": [ "islandrank >= 2" ] }
          ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_raidlength1" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Unlock: Extended Expeditions",
        "condition": {
          "and": [
            { "not": { "u_has_mission": "SKYISLAND_UPGRADE_raidlength2" } },
            { "math": [ "longerraids == 1" ] },
            { "math": [ "islandrank >= 4" ] }
          ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_raidlength2" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Unlock Start Location: Basements",
        "condition": {
          "and": [ { "not": { "u_has_mission": "SKYISLAND_UPGRADE_basementsunlock" } }, { "math": [ "basementsunlocked == 0" ] }, { "not": { "mod_is_loaded": "voidblock" } } ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_basementsunlock" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Unlock Start Location: Rooftops",
        "condition": {
          "and": [
            { "not": { "u_has_mission": "SKYISLAND_UPGRADE_roofsunlock" } },
            { "math": [ "roofsunlocked == 0" ] },
            { "math": [ "islandrank >= 2" ] },
            { "not": { "mod_is_loaded": "voidblock" } }
          ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_roofsunlock" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Unlock Start Location: Labs",
        "condition": {
          "and": [
            { "not": { "u_has_mission": "SKYISLAND_UPGRADE_labsunlock" } },
            { "math": [ "labsunlocked == 0" ] },
            { "math": [ "islandrank >= 4" ] },
            { "not": { "mod_is_loaded": "voidblock" } }
          ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_labsunlock" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Security Alpha",
        "condition": { "and": [ { "not": { "u_has_mission": "SKYISLAND_UPGRADE_security1" } }, { "math": [ "securitylevel == 0" ] } ] },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_security1" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Security Beta",
        "condition": {
          "and": [
            { "not": { "u_has_mission": "SKYISLAND_UPGRADE_security2" } },
            { "math": [ "securitylevel == 1" ] },
            { "math": [ "islandrank >= 2" ] }
          ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_security2" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Security Gamma",
        "condition": {
          "and": [
            { "not": { "u_has_mission": "SKYISLAND_UPGRADE_security3" } },
            { "math": [ "securitylevel == 2" ] },
            { "math": [ "islandrank >= 4" ] }
          ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_security3" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Security Epsilon",
        "condition": {
          "and": [
            { "not": { "u_has_mission": "SKYISLAND_UPGRADE_security4" } },
            { "math": [ "securitylevel == 3" ] },
            { "math": [ "islandrank >= 4" ] }
          ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_security4" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      {
        "text": "Security Kappa",
        "condition": {
          "and": [
            { "not": { "u_has_mission": "SKYISLAND_UPGRADE_security5" } },
            { "math": [ "securitylevel == 4" ] },
            { "math": [ "islandrank >= 4" ] }
          ]
        },
        "effect": [ { "assign_mission": "SKYISLAND_UPGRADE_security5" } ],
        "topic": "SKYISLAND_UPGRADES_RAIDS"
      },
      { "text": "Nevermind.", "topic": "SKYISLAND_UPGRADE" }
    ]
  }
]
