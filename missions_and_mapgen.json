[
  {
    "//1": "changes u_near_om_location condition",
    "type": "effect_on_condition",
    "id": "EOC_safely_landed",
    "//": "Called on landing.  Adds the major earthside affects that are required to register the player as not at home, warpcloak invisibility, starts warpsickness ticking, and creates exits, slaughter missions, and target missions.",
    "condition": { "not": { "u_near_om_location": "sky_island_core_voidblock", "range": 4 } },
    "effect": [
      {
        "u_add_effect": "warpcloak",
        "intensity": 1,
        "duration": { "global_val": "invistime", "default": "60 s" }
      },
      {
        "u_message": "You're still materializing and not fully visible yet.  In about <global_val:invistime> seconds, the world will be able to see you, so if you were warped into danger, now's your chance to get to cover.",
        "popup": false
      },
      {
        "u_message": "You've arrived!\nPress a key when ready and random missions will be generated for this expedition.  This may take another minute.",
        "popup": true
      },
      { "u_add_trait": "awayfromhome" },
      { "math": [ "timeawayfromhome = 0 - bonuspulses" ] },
      { "u_add_effect": "warpsickness", "intensity": 6, "duration": "PERMANENT" },
      { "run_eocs": [ "EOC_create_slaughter", "EOC_SKY_ISLAND_CLIMATE_RESET" ] },
      {
        "switch": { "math": [ "bonusmissions" ] },
        "cases": [
          { "case": 1, "effect": [ { "run_eocs": "EOC_create_bonus" } ] },
          { "case": 2, "effect": [ { "run_eocs": [ "EOC_create_bonus", "EOC_create_bonus" ] } ] },
          { "case": 3, "effect": [ { "run_eocs": [ "EOC_create_bonus", "EOC_create_bonus", "EOC_create_bonus" ] } ] }
        ]
      },
      {
        "switch": { "math": [ "bonusexits" ] },
        "cases": [
          { "case": 0, "effect": [ { "run_eocs": "EOC_create_extract" } ] },
          { "case": 1, "effect": [ { "run_eocs": [ "EOC_create_extract", "EOC_create_extract" ] } ] },
          {
            "case": 2,
            "effect": [ { "run_eocs": [ "EOC_create_extract", "EOC_create_extract", "EOC_create_extract" ] } ]
          }
        ]
      },
      {
        "if": { "math": [ "goingtolabs == 1" ] },
        "then": [ { "u_consume_item": "warp_labs_catalyst", "count": 1 }, { "math": [ "goingtolabs = 0" ] } ]
      }
    ],
    "false_effect": [
      {
        "u_message": "Something went wrong.  The game could not find a suitable teleport location.  Please try using the obelisk again.",
        "popup": true
      }
    ]
  },
  {
    "id": "MISSION_BONUS_TREASURE",
    "type": "mission_definition",
    "name": { "str": "Find the warp shards!" },
    "goal": "MGOAL_GO_TO",
    "description": "A very small cluster of warp energy has left shards behind at this location.  All you need to do is find and retrieve them.  There may be threats nearby, but unlike most tasks, no special guards are on-site.  A minimal reward, but little risk.",
    "difficulty": 0,
    "value": 0,
    "start": {
      "assign_mission_target": { "var": { "global_val": "OM_missionspot" } },
      "update_mapgen": { "place_nested": [ { "chunks": [ "mx_treasuregoal" ], "x": [ 0, 13 ], "y": [ 0, 13 ] } ] }
    },
    "end": { "effect": [ { "run_eocs": "EOC_bonuspulse" }, { "math": [ "u_missionswon++" ] }, { "math": [ "u_val('exp') += 25" ] } ] }
  }
]
